<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฏุงุดุจูุฑุฏ ุงูฺฉุงูโุณูุฌ ุจุงุบ ูพุฑูุฏฺฏุงู</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix@2.0.1/dist/chartjs-chart-matrix.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
            border: 1px solid transparent;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .heatmap-positive {
            background-color: #dcfce7; /* green-100 */
            color: #166534; /* green-800 */
        }
        .heatmap-negative {
            background-color: #fee2e2; /* red-100 */
            color: #991b1b; /* red-800 */
        }
         .heatmap-base {
            background-color: #e0e7ff; /* indigo-100 */
            color: #3730a3; /* indigo-800 */
        }
        .apexcharts-tooltip {
            direction: ltr;
        }
        .apexcharts-legend-text {
             font-family: 'Vazirmatn', sans-serif !important;
        }
         .chart-container-heatmap {
            position: relative;
            width: 100%;
            height: 500px;
        }
        .intro-card {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        }

        /* Dark Mode Styles */
        html.dark body {
            background-color: #0f172a; /* slate-900 */
            color: #cbd5e1; /* slate-300 */
        }
        html.dark .card {
            background-color: #1e293b; /* slate-800 */
            border-color: #334155; /* slate-700 */
        }
        html.dark .card:hover {
            box-shadow: 0 0 20px rgba(56, 189, 248, 0.3); /* Neon glow on hover */
        }
        html.dark .intro-card {
            border-color: #38bdf8; /* sky-400 */
            box-shadow: 0 0 25px rgba(56, 189, 248, 0.25);
        }
        html.dark h1, html.dark h2, html.dark h3, html.dark .font-bold, html.dark .font-semibold {
            color: #f1f5f9; /* slate-100 */
        }
        html.dark .text-slate-500 { color: #94a3b8; } /* slate-400 */
        html.dark .text-slate-800 { color: #f1f5f9; } /* slate-100 */
        html.dark .text-slate-700 { color: #e2e8f0; } /* slate-200 */
        html.dark .text-slate-600 { color: #cbd5e1; } /* slate-300 */
        html.dark .text-slate-400 { color: #94a3b8; }
        
        /* KPI Colors & Neon Effect */
        html.dark .text-green-600 { color: #4ade80; text-shadow: 0 0 6px rgba(74, 222, 128, 0.8); }
        html.dark .text-blue-600 { color: #60a5fa; text-shadow: 0 0 6px rgba(96, 165, 250, 0.8); }
        html.dark .text-orange-600 { color: #fb923c; text-shadow: 0 0 6px rgba(251, 146, 60, 0.8); }
        html.dark .text-amber-600 { color: #facc15; text-shadow: 0 0 6px rgba(250, 204, 21, 0.8); }
        html.dark .text-teal-600 { color: #2dd4bf; text-shadow: 0 0 6px rgba(45, 212, 191, 0.8); }
        html.dark .text-indigo-600 { color: #818cf8; text-shadow: 0 0 6px rgba(129, 140, 248, 0.8); }

        /* Table & Heatmap */
        html.dark .bg-slate-100 { background-color: #334155; }
        html.dark tfoot .bg-slate-100 { background-color: #334155 !important; }
        html.dark .divide-slate-200 > :not([hidden]) ~ :not([hidden]) { border-color: #475569; }
        html.dark .heatmap-positive { background-color: rgba(74, 222, 128, 0.2); color: #86efac; }
        html.dark .heatmap-negative { background-color: rgba(248, 113, 113, 0.2); color: #fca5a5; }
        html.dark .heatmap-base { background-color: rgba(99, 102, 241, 0.2); color: #a5b4fc; }
        html.dark .border { border-color: #475569; }
        html.dark .bg-slate-50 { background-color: #1e293b; }
        html.dark .text-yellow-800 { color: #fde047; }
        html.dark .bg-yellow-100 { background-color: rgba(250, 204, 21, 0.2); }
        html.dark .text-green-800 { color: #86efac; }
        html.dark .bg-green-100 { background-color: rgba(74, 222, 128, 0.2); }
        html.dark .text-red-800 { color: #fca5a5; }
        html.dark .bg-red-100 { background-color: rgba(248, 113, 113, 0.2); }
    </style>
</head>
<body class="p-4 md:p-8 bg-slate-100 transition-colors duration-300">
    <div class="max-w-7xl mx-auto relative">
        <!-- Theme Toggler Button -->
        <div class="absolute top-0 left-0 p-2 z-10">
            <button id="theme-toggle" class="bg-slate-800 text-yellow-300 hover:bg-slate-700 dark:bg-slate-100 dark:text-orange-500 dark:hover:bg-slate-200 p-2 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 dark:focus:ring-offset-slate-900 transition-all">
                <i id="theme-icon-sun" class="w-5 h-5 hidden" data-lucide="sun"></i>
                <i id="theme-icon-moon" class="w-5 h-5" data-lucide="moon"></i>
            </button>
        </div>

        <!-- Header -->
        <header class="mb-8 text-center pt-12 md:pt-0">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-800">ุฏุงุดุจูุฑุฏ ุงูฺฉุงูโุณูุฌ ูู-ุงูุชุตุงุฏ</h1>
            <p class="text-slate-500 mt-2 text-lg">ูพุฑูฺู ุจุงุบ ูพุฑูุฏฺฏุงู ุดุฑู ุชูุฑุงู</p>
        </header>

        <!-- New Infographic Intro Section -->
        <section class="card intro-card text-white mb-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div class="space-y-4">
                     <h2 class="text-3xl font-bold text-sky-400">ูุนุฑู ูพุฑูฺู: ุชูุณุนู ู ุจูุฑูโุจุฑุฏุงุฑ ุจุงุบ ูพุฑูุฏฺฏุงู</h2>
                     <p class="text-slate-300">
                        ุงู ูพุฑูฺู ุจุง ูุฏู ุชูุณุนูุ ุชุฌูุฒ ู ุจูุฑูโุจุฑุฏุงุฑ ฑน ุณุงูู ุงุฒ ูุฌููุนู ุจุงุบ ูพุฑูุฏฺฏุงู ุดุฑู ุชูุฑุงู ุฏุฑ ูุงูุจ ูุฑุงุฑุฏุงุฏ BOT ุจุง ุดูุฑุฏุงุฑ ุชุนุฑู ุดุฏู ุงุณุช. ูุฏู ุงุตูุ ุชุจุฏู ุดุฏู ุจู ฺฉ ููุตุฏ ฺฏุฑุฏุดฺฏุฑ ูพุดุฑู ุงุฒ ุทุฑู ูุนุงูโุณุงุฒ ุจุฎุดโูุง ุบุฑูุนุงู ู ุงูุฒุงุด ุฌุฐุงุจุชโูุง ููุฌูุฏ ุงุณุช.
                     </p>
                </div>
                 <div class="grid grid-cols-2 gap-6 text-center">
                    <div class="bg-slate-700/50 p-4 rounded-lg">
                        <i data-lucide="map" class="w-10 h-10 mx-auto text-green-400 mb-2"></i>
                        <p class="font-bold text-xl">ฒณ ูฺฉุชุงุฑ</p>
                        <p class="text-xs text-slate-400">ูุณุงุญุช ฺฉู ูพุฑูฺู</p>
                    </div>
                     <div class="bg-slate-700/50 p-4 rounded-lg">
                        <i data-lucide="file-text" class="w-10 h-10 mx-auto text-green-400 mb-2"></i>
                        <p class="font-bold text-xl">BOT</p>
                        <p class="text-xs text-slate-400">ูุฏู ูุฑุงุฑุฏุงุฏ</p>
                    </div>
                    <div class="bg-slate-700/50 p-4 rounded-lg">
                        <i data-lucide="map-pin" class="w-10 h-10 mx-auto text-green-400 mb-2"></i>
                        <p class="font-bold text-lg leading-tight">ุงุชูุจุงู ุจุงุจุง</p>
                        <p class="text-xs text-slate-400 mt-1">ูููุนุช ูฺฉุงู</p>
                    </div>
                     <div class="bg-slate-700/50 p-4 rounded-lg">
                        <i data-lucide="alert-triangle" class="w-10 h-10 mx-auto text-yellow-400 mb-2"></i>
                        <p class="font-bold text-lg leading-tight">ุฑุณฺฉ ุจุงูุง</p>
                        <p class="text-xs text-slate-400 mt-1">ุญุณุงุณุช ุจู ุฏุฑุขูุฏ</p>
                    </div>
                 </div>
            </div>
        </section>

        <!-- Main KPIs -->
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-6 mb-8">
            <div class="card text-center">
                <p class="text-slate-500 text-sm">ุฎุงูุต ุงุฑุฒุด ูุนู (NPV)</p>
                <p class="text-2xl font-bold text-green-600 mt-2">ฐ.ฑฐ+</p>
                <p class="text-xs text-slate-400 mt-1">ููุงุฑุฏ ุฑุงู</p>
            </div>
             <div class="card text-center">
                <p class="text-slate-500 text-sm">ูุฑุฎ ุจุงุฒุฏู ุฏุงุฎู (IRR)</p>
                <p class="text-2xl font-bold text-blue-600 mt-2">ดฐ.ฐฐูช</p>
                 <p class="text-xs text-slate-400 mt-1">ุจุฑุงุจุฑ ูุฒูู ุณุฑูุงู</p>
            </div>
            <div class="card text-center">
                <p class="text-slate-500 text-sm">ุจุงุฒฺฏุดุช ุณุฑูุงู (PP)</p>
                <p class="text-2xl font-bold text-orange-600 mt-2">ณ.ถณ</p>
                 <p class="text-xs text-slate-400 mt-1">ุณุงู</p>
            </div>
            <div class="card text-center">
                <p class="text-slate-500 text-sm">ุจุงุฒฺฏุดุช ุณูุฏ (DPBP)</p>
                <p class="text-2xl font-bold text-amber-600 mt-2">ฑธ.นธ</p>
                 <p class="text-xs text-slate-400 mt-1">ุณุงู</p>
            </div>
             <div class="card text-center">
                <p class="text-slate-500 text-sm">ุฏูุฑู ุจูุฑูโุจุฑุฏุงุฑ</p>
                <p class="text-2xl font-bold text-teal-600 mt-2">ฑน</p>
                 <p class="text-xs text-slate-400 mt-1">ุณุงู</p>
            </div>
            <div class="card text-center">
                <p class="text-slate-500 text-sm">ุณุฑูุงูโฺฏุฐุงุฑ ุซุงุจุช</p>
                <p class="text-2xl font-bold text-indigo-600 mt-2">ตทต</p>
                 <p class="text-xs text-slate-400 mt-1">ููุงุฑุฏ ุฑุงู</p>
            </div>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 space-y-8">
                <div class="card">
                    <h2 class="text-xl font-semibold text-slate-700 mb-4">ูููุฏุงุฑ ุฌุฑุงู ููุฏ (ููุงุฑุฏ ุฑุงู)</h2>
                    <div id="cashFlowChart"></div>
                </div>
                 <div class="card">
                     <h2 class="text-xl font-semibold text-slate-700 mb-4">ุฑููุฏ ุฏุฑุขูุฏูุง ุฏุฑ ููุงุจู ูุฒููโูุง ุนููุงุช (ููุงุฑุฏ ุฑุงู)</h2>
                    <div id="revenueOpexChart"></div>
                </div>
                 <div class="card">
                    <h2 class="text-xl font-semibold text-slate-700 mb-4">ุชุญูู ููุทู ุณุฑ ุจู ุณุฑ (ุฏูุฑู ุจุงุฒฺฏุดุช)</h2>
                    <div id="breakevenLineChart" style="height: 350px;"></div>
                </div>
            </div>
            <div class="lg:col-span-1 space-y-8">
                <div class="card">
                    <h2 class="text-xl font-semibold text-slate-700 mb-4">ุชุฑฺฉุจ ุณุฑูุงูโฺฏุฐุงุฑ ุซุงุจุช (CAPEX)</h2>
                    <div id="capexChartContainer" class="relative">
                        <div id="capexChart"></div>
                    </div>
                    <div class="mt-4 -mx-2 overflow-x-auto">
                        <h3 class="text-lg font-semibold text-slate-700 mb-3 px-2">ุฌุฏูู ุชูฺฉฺฉ ูุฒููโูุง ุซุงุจุช (ููุงุฑุฏ ุฑุงู)</h3>
                        <table id="capex-table" class="w-full text-sm text-right text-slate-600">
                            <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                                <tr>
                                    <th class="px-2 py-2 font-semibold">ุดุฑุญ ูุฒูู</th>
                                    <th class="px-2 py-2 font-semibold">ูุจูุบ</th>
                                    <th class="px-2 py-2 font-semibold hidden md:table-cell">ุชูุถุญุงุช</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-200">
                                <tr data-index="0" class="cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50">
                                    <td class="px-2 py-2">ูุฒูู ุงุจูู ู ุณุงุฎุชโูุณุงุฒ</td>
                                    <td class="px-2 py-2">ฒธต.ฐ</td>
                                    <td class="px-2 py-2 hidden md:table-cell">ุดุงูู ุณุงุฎุช ุจุฎุดโูุง ุฌุฏุฏ (ูุงููุฏ ุจุงุบ ุฎุฒูุฏฺฏุงู) ู ุจุงุฒุณุงุฒ ุงูุงฺฉู ููุฌูุฏ.</td>
                                </tr>
                                <tr data-index="1" class="cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50">
                                    <td class="px-2 py-2">ูุญูุทูโุณุงุฒ ู ุขูุงุฏูโุณุงุฒ ุฒูู</td>
                                    <td class="px-2 py-2">ธฐ.ฐ</td>
                                    <td class="px-2 py-2 hidden md:table-cell">ุดุงูู ุชุณุทุญุ ูุณุฑุณุงุฒุ ูุถุง ุณุจุฒ ู ุญุตุงุฑฺฉุด.</td>
                                </tr>
                                <tr data-index="2" class="cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50">
                                    <td class="px-2 py-2">ุชุฃุณุณุงุช (ุขุจุ ุจุฑูุ ฺฏุงุฒุ ูุงุถูุงุจ)</td>
                                    <td class="px-2 py-2">ตต.ฐ</td>
                                    <td class="px-2 py-2 hidden md:table-cell">ุฒุฑุณุงุฎุชโูุง ุญุงุช ุจุฑุง ุจูุฑูโุจุฑุฏุงุฑ ุงุฒ ูุฌููุนู.</td>
                                </tr>
                                <tr data-index="3" class="cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50">
                                    <td class="px-2 py-2">ุชุฌูุฒุงุช ุจุงุบ ุฎุฒูุฏฺฏุงู</td>
                                    <td class="px-2 py-2">ดต.ฐ</td>
                                    <td class="px-2 py-2 hidden md:table-cell">ุดุงูู ุชุฌูุฒุงุช ุงููุ ูฺฏูุฏุงุฑ ู ุณุณุชูโูุง ฺฉูุชุฑู.</td>
                                </tr>
                                <tr data-index="4" class="cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50">
                                    <td class="px-2 py-2">ุชุฌูุฒุงุช ูพุฐุฑุง ู ุงูุงฺฉู ุฏุฑุขูุฏุฒุง</td>
                                    <td class="px-2 py-2">ณฐ.ฐ</td>
                                    <td class="px-2 py-2 hidden md:table-cell">ุชุฌูุฒ ฺฉุงูู ุขุดูพุฒุฎุงูู ุตูุนุชุ ูุจููุงู ุฑุณุชูุฑุงู ู ุบุฑููโูุง.</td>
                                </tr>
                                <tr data-index="5" class="cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50">
                                    <td class="px-2 py-2">ุชุฌูุฒุงุช ฺฉููฺฉ ุฏุงููพุฒุดฺฉ</td>
                                    <td class="px-2 py-2">ฑฐ.ฐ</td>
                                    <td class="px-2 py-2 hidden md:table-cell">ุชุฃูู ุชุฌูุฒุงุช ูพุงู ุจุฑุง ฺฉููฺฉ.</td>
                                </tr>
                                <tr data-index="6" class="cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50">
                                    <td class="px-2 py-2">ูุฒููโูุง ูุจู ุงุฒ ุจูุฑูโุจุฑุฏุงุฑ</td>
                                    <td class="px-2 py-2">ฒณ.ต</td>
                                    <td class="px-2 py-2 hidden md:table-cell">ุดุงูู ูุฒููโูุง ุงุฎุฐ ูุฌูุฒุ ูุทุงูุนุงุชุ ุจุงุฒุงุฑุงุจ ู ุขููุฒุด ุงููู.</td>
                                </tr>
                                <tr data-index="7" class="cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50">
                                    <td class="px-2 py-2">ูุฒููโูุง ูพุดโุจู ูุดุฏู (Contingency)</td>
                                    <td class="px-2 py-2">ดถ.ต</td>
                                    <td class="px-2 py-2 hidden md:table-cell">ูุนุงุฏู ธ.ธูช ุงุฒ ูุฌููุน ูุฒููโูุง ุจุงูุง ุจุฑุง ูพูุดุด ุฑุณฺฉโูุง.</td>
                                </tr>
                            </tbody>
                            <tfoot class="bg-slate-100 font-bold">
                                <tr data-index="total" class="cursor-pointer hover:bg-slate-200 dark:hover:bg-slate-600">
                                    <td class="px-2 py-2">ุฌูุน ฺฉู ุณุฑูุงูโฺฏุฐุงุฑ ุซุงุจุช</td>
                                    <td class="px-2 py-2">ตทต.ฐ</td>
                                    <td class="px-2 py-2 hidden md:table-cell"></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                <div class="card">
                    <h2 class="text-xl font-semibold text-slate-700 mb-4">ููุดู ุฑุงู ุฒูุงู ูพุฑูฺู</h2>
                    <div style="height:300px;"><canvas id="newRoadmapChart"></canvas></div>
                </div>
            </div>
        </div>
        
        <!-- Physical Plan Section -->
        <div class="grid grid-cols-1 lg:grid-cols-5 gap-8 mt-8">
            <div class="lg:col-span-3 card">
                <h2 class="text-xl font-semibold text-slate-700 mb-4">ุจุฑูุงูู ูุฒฺฉ ู ูุณุงุญุชโูุง</h2>
                 <p class="text-sm text-slate-500 mb-4">ูุณุงุญุช ฺฉู: <strong>ฒณ ูฺฉุชุงุฑ</strong> (ูุงุฒ ฑ: ฑถ.ต ูฺฉุชุงุฑุ ูุงุฒ ฒ: ถ.ต ูฺฉุชุงุฑ)</p>
                 <div class="max-h-80 overflow-y-auto pr-2">
                     <table class="w-full text-sm text-right text-slate-600">
                         <thead class="text-xs text-slate-700 uppercase bg-slate-100 sticky top-0">
                            <tr>
                                <th scope="col" class="px-4 py-2">ูุงุฒ</th>
                                <th scope="col" class="px-4 py-2">ุดุฑุญ</th>
                                <th scope="col" class="px-4 py-2">ูุณุงุญุช (mยฒ)</th>
                                <th scope="col" class="px-4 py-2">ูุถุนุช</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-200">
                            <tr><td class="px-4 py-2">ฑ</td><td class="px-4 py-2">ูุถุง ุญุงุช ูุญุด</td><td class="px-4 py-2">นต,ฐฐฐ</td><td class="px-4 py-2"><span class="bg-yellow-100 text-yellow-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">ูููโูุนุงู</span></td></tr>
                            <tr><td class="px-4 py-2">ฑ</td><td class="px-4 py-2">ุฑุณุชูุฑุงู ุณููู</td><td class="px-4 py-2">ทต</td><td class="px-4 py-2"><span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">ูุนุงู</span></td></tr>
                            <tr><td class="px-4 py-2">ฑ</td><td class="px-4 py-2">ุฑุณุชูุฑุงู ูุงุฒ ฺฉ</td><td class="px-4 py-2">ตฐฐ</td><td class="px-4 py-2"><span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">ุบุฑูุนุงู</span></td></tr>
                            <tr><td class="px-4 py-2">ฑ</td><td class="px-4 py-2">ุณุงูู ฺฏุฑูุณุฑ</td><td class="px-4 py-2">ฑ,ฐฐฐ</td><td class="px-4 py-2"><span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">ูุนุงู</span></td></tr>
                            <tr><td class="px-4 py-2">ฑ</td><td class="px-4 py-2">ฺฉุงู ุดุงูพ</td><td class="px-4 py-2">ฒด</td><td class="px-4 py-2"><span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">ูุนุงู</span></td></tr>
                             <tr><td class="px-4 py-2">ฑ</td><td class="px-4 py-2">ุบุฑููโูุง ุฎุฑูุฌ</td><td class="px-4 py-2">ณฐฐ</td><td class="px-4 py-2"><span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">ุบุฑูุนุงู</span></td></tr>
                            <tr><td class="px-4 py-2">ฑ</td><td class="px-4 py-2">ูุถุง ุณุจุฒ ู ูพุงุฏูโุฑุงู</td><td class="px-4 py-2">ถท,ถทท</td><td class="px-4 py-2"><span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">ูุนุงู</span></td></tr>
                            <tr><td class="px-4 py-2">ฒ</td><td class="px-4 py-2">ุณุงุฒู ฺฉุงุจู ู ุชูุฑ</td><td class="px-4 py-2">ท,ฒฐฐ</td><td class="px-4 py-2"><span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">ูุนุงู</span></td></tr>
                             <tr><td class="px-4 py-2">ฒ</td><td class="px-4 py-2">ุฑุณุชูุฑุงู ูุงุฒ ุฏู</td><td class="px-4 py-2">ดฐฐ</td><td class="px-4 py-2"><span class="bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">ุบุฑูุนุงู</span></td></tr>
                            <tr><td class="px-4 py-2">ฒ</td><td class="px-4 py-2">ุจูููโูุง</td><td class="px-4 py-2">ถฐ</td><td class="px-4 py-2"><span class="bg-yellow-100 text-yellow-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">ูููโูุนุงู</span></td></tr>
                             <tr><td class="px-4 py-2">ฒ</td><td class="px-4 py-2">ุฏุฑุงฺู ู ูุถุง ุณุจุฒ</td><td class="px-4 py-2">ตถ,ถนฐ</td><td class="px-4 py-2"><span class="bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full">ูุนุงู</span></td></tr>
                        </tbody>
                     </table>
                 </div>
            </div>
            <div class="lg:col-span-2 card">
                <h2 class="text-xl font-semibold text-slate-700 mb-4">ูุงุชุฑุณ ุชุญูู ุญุณุงุณุช (NPV & IRR)</h2>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-center font-medium">
                        <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                            <tr>
                                <th class="px-4 py-3">ูุชุบุฑ</th>
                                <th class="px-4 py-3">ุชุบุฑ</th>
                                <th class="px-4 py-3">NPV (ููุงุฑุฏ ุฑุงู)</th>
                                <th class="px-4 py-3">IRR</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td rowspan="3" class="border p-2 align-middle bg-slate-50 font-semibold">ุฏุฑุขูุฏูุง</td>
                                <td class="border p-2">ฑฐูช-</td><td class="border p-2 heatmap-negative">-ดน.ธ</td><td class="border p-2 heatmap-negative">ณธ.ฒูช</td>
                            </tr>
                            <tr>
                                <td class="border p-2 font-semibold">ูพุงู</td><td class="border p-2 heatmap-base">ฐ.ฑ+</td><td class="border p-2 heatmap-base">ดฐ.ฐูช</td>
                            </tr>
                            <tr>
                                <td class="border p-2">ฑฐูช+</td><td class="border p-2 heatmap-positive">ตฐ.ฐ+</td><td class="border p-2 heatmap-positive">ดฑ.ทูช</td>
                            </tr>
                            <tr class="bg-slate-50">
                                <td rowspan="3" class="border p-2 align-middle font-semibold">ูุฒูู (OPEX)</td>
                                <td class="border p-2">ฑฐูช+</td><td class="border p-2 heatmap-negative">-ณถ.ถ</td><td class="border p-2 heatmap-negative">ณธ.ถูช</td>
                            </tr>
                            <tr class="bg-slate-50">
                                <td class="border p-2 font-semibold">ูพุงู</td><td class="border p-2 heatmap-base">ฐ.ฑ+</td><td class="border p-2 heatmap-base">ดฐ.ฐูช</td>
                            </tr>
                            <tr class="bg-slate-50">
                                <td class="border p-2">ฑฐูช-</td><td class="border p-2 heatmap-positive">ณถ.ธ+</td><td class="border p-2 heatmap-positive">ดฑ.ณูช</td>
                            </tr>
                             <tr>
                                <td rowspan="3" class="border p-2 align-middle bg-slate-50 font-semibold">ุณุฑูุงูโฺฏุฐุงุฑ (CAPEX)</td>
                                <td class="border p-2">ฑฐูช+</td><td class="border p-2 heatmap-negative">-ตท.ด</td><td class="border p-2 heatmap-negative">ณถ.ธูช</td>
                            </tr>
                            <tr>
                                <td class="border p-2 font-semibold">ูพุงู</td><td class="border p-2 heatmap-base">ฐ.ฑ+</td><td class="border p-2 heatmap-base">ดฐ.ฐูช</td>
                            </tr>
                            <tr>
                                <td class="border p-2">ฑฐูช-</td><td class="border p-2 heatmap-positive">ตท.ถ+</td><td class="border p-2 heatmap-positive">ดณ.ธูช</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- New Sensitivity Analysis Heatmap -->
        <div class="mt-12">
            <header class="text-center mb-8">
                 <h1 class="text-3xl md:text-4xl font-black text-slate-900">ุชุญูู ุญุณุงุณุช: ูุจุถ ุณูุฏุขูุฑ ูพุฑูฺู</h1>
                 <p class="text-lg text-slate-600 mt-2">ุจุฑุฑุณ ูุงฺฉูุด ูุฑุฎ ุจุงุฒุฏู ุฏุงุฎู (IRR) ุจู ููุณุงูุงุช ฒฐูชยฑ ุฏุฑุขูุฏ ู ูุฒูู</p>
            </header>
            
            <section class="mb-8">
                <div class="card p-6">
                    <h2 class="text-2xl font-bold text-center mb-1">ููุดู ุญุฑุงุฑุช ุณูุฏุขูุฑ (IRR)</h2>
                    <p class="text-center text-slate-500 mb-6">ุจุฑุง ูุดุงูุฏู ุฌุฒุฆุงุชุ ูุงูุณ ุฑุง ุฑู ูุฑ ุฎุงูู ุญุฑฺฉุช ุฏูุฏ</p>
                    <div class="chart-container-heatmap">
                        <canvas id="sensitivityHeatmap"></canvas>
                    </div>
                </div>
            </section>
             <section>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="card text-center border-t-4 border-green-500">
                        <p class="text-4xl mb-2">๐</p>
                        <h3 class="text-xl font-bold text-green-600">ุจูุชุฑู ุณูุงุฑู</h3>
                        <p class="text-4xl font-black text-green-500 my-2">ดต.ณูช</p>
                        <p class="text-slate-500 text-sm">ฒฐูช ฺฉุงูุด ูุฒูู | ฒฐูช ุงูุฒุงุด ุฏุฑุขูุฏ</p>
                    </div>
                    <div class="card text-center border-t-4 border-blue-500">
                         <p class="text-4xl mb-2">๐ฏ</p>
                        <h3 class="text-xl font-bold text-blue-600">ุณูุงุฑู ูพุงู</h3>
                        <p class="text-4xl font-black text-blue-500 my-2">ดฐ.ฐูช</p>
                        <p class="text-slate-500 text-sm">ุจุฏูู ุชุบุฑ ุฏุฑ ูุฒูู ู ุฏุฑุขูุฏ</p>
                    </div>
                    <div class="card text-center border-t-4 border-red-500">
                        <p class="text-4xl mb-2">๐</p>
                        <h3 class="text-xl font-bold text-red-600">ุจุฏุชุฑู ุณูุงุฑู</h3>
                        <p class="text-4xl font-black text-red-500 my-2">ณด.ฒูช</p>
                        <p class="text-slate-500 text-sm">ฒฐูช ุงูุฒุงุด ูุฒูู | ฒฐูช ฺฉุงูุด ุฏุฑุขูุฏ</p>
                    </div>
                </div>
            </section>
        </div>


    </div>

<script>
    lucide.createIcons();

    // Chart Global Options
    const chartOptions = {
        chart: {
            fontFamily: 'Vazirmatn, sans-serif',
            toolbar: { show: true, tools: { download: '<i class="w-4 h-4" data-lucide="download"></i>' }},
        },
        dataLabels: { enabled: false },
        stroke: { curve: 'smooth', width: 3 },
        markers: { size: 0 },
        tooltip: { theme: 'light', style: { fontSize: '12px', fontFamily: 'Vazirmatn, sans-serif' }},
    };
    const chartDefaultOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { labels: { color: '#cbd5e1', font: { family: 'Vazirmatn'}}},
            tooltip: { bodyFont: { family: 'Vazirmatn' }, titleFont: { family: 'Vazirmatn' }}
        }
    };
    
    // Cash Flow Chart
    const cashFlowData = {
        years: ['ุณุงู ฐ', 'ฑ', 'ฒ', 'ณ', 'ด', 'ต', 'ถ', 'ท', 'ธ', 'น', 'ฑฐ', 'ฑฑ', 'ฑฒ', 'ฑณ', 'ฑด', 'ฑต', 'ฑถ', 'ฑท', 'ฑธ', 'ฑน'],
        fcf: [-575.0, 121.5, 145.8, 175.0, 210.0, 252.0, 302.4, 362.8, 435.4, 522.5, 627.0, 752.4, 902.9, 1083.5, 1300.2, 1560.2, 1872.2, 2246.7, 2696.0, 3302.3]
    };
    const cashFlowChart = new ApexCharts(document.querySelector("#cashFlowChart"), {
        ...chartOptions,
        series: [{ name: 'ุฌุฑุงู ููุฏ ุขุฒุงุฏ (FCF)', type: 'column', data: cashFlowData.fcf }],
        chart: { ...chartOptions.chart, height: 350, type: 'line' },
        xaxis: { categories: cashFlowData.years, labels: { style: { fontFamily: 'Vazirmatn' }}},
        yaxis: [{ title: { text: 'ุฌุฑุงู ููุฏ ุขุฒุงุฏ (FCF)', style: { fontFamily: 'Vazirmatn', fontWeight: 400 }}}],
        colors: ['#2563eb'],
        plotOptions: { bar: { colors: { ranges: [{ from: -1000, to: 0, color: '#ef4444' }, { from: 1, to: 10000, color: '#2563eb' }] }, columnWidth: '80%' }},
        legend: { position: 'top', horizontalAlign: 'left' }
    });
    cashFlowChart.render();
    
     // Revenue vs OPEX Chart
    const revenueOpexData = {
        years: ['ฑ', 'ฒ', 'ณ', 'ด', 'ต', 'ถ', 'ท', 'ธ', 'น', 'ฑฐ', 'ฑฑ', 'ฑฒ', 'ฑณ', 'ฑด', 'ฑต', 'ฑถ', 'ฑท', 'ฑธ', 'ฑน'],
        revenue: [349.3, 419.3, 482.7, 555.1, 638.4, 734.2, 844.3, 970.9, 1117.2, 1285.0, 1477.7, 1700.2, 1956.4, 2249.6, 2588.1, 2976.4, 3422.7, 3936.0, 4526.5],
        opex: [227.8, 262.1, 301.4, 346.6, 398.6, 458.3, 527.1, 606.2, 697.1, 801.7, 922.0, 1060.3, 1219.5, 1402.9, 1614.3, 1856.0, 2134.9, 2455.6, 2823.4]
    };
    const revenueOpexChart = new ApexCharts(document.querySelector("#revenueOpexChart"), {
        ...chartOptions,
        series: [{ name: 'ุฏุฑุขูุฏ ฺฉู', data: revenueOpexData.revenue }, { name: 'ูุฒูู ุนููุงุช (OPEX)', data: revenueOpexData.opex }],
        chart: { ...chartOptions.chart, height: 350, type: 'line' },
        xaxis: { title: { text: 'ุณุงู ุจูุฑูโุจุฑุฏุงุฑ', style: { fontFamily: 'Vazirmatn', fontWeight: 400 }}, categories: revenueOpexData.years, labels: { style: { fontFamily: 'Vazirmatn' }}},
        yaxis: { title: { text: 'ููุงุฑุฏ ุฑุงู', style: { fontFamily: 'Vazirmatn', fontWeight: 400 }}},
        colors: ['#16a34a', '#dc2626'],
        legend: { position: 'top', horizontalAlign: 'left' }
    });
    revenueOpexChart.render();

    // Breakeven Line Chart
    const breakevenData = {
        years: ['ฐ', 'ฑ', 'ฒ', 'ณ', 'ด', 'ต', 'ถ', 'ท', 'ธ', 'น', 'ฑฐ', 'ฑฑ', 'ฑฒ', 'ฑณ', 'ฑด', 'ฑต', 'ฑถ', 'ฑท', 'ฑธ', 'ฑน'],
        cumulative_fcf: [-575.0, -453.5, -307.7, -132.7, 77.3, 329.3, 631.7, 994.5, 1429.9, 1952.4, 2579.4, 3331.8, 4234.7, 5318.2, 6618.4, 8178.6, 10050.8, 12297.5, 14993.5, 18295.8],
        cumulative_npv: [-575.0, -488.2, -413.8, -350.1, -295.4, -248.5, -208.4, -173.9, -144.5, -119.2, -97.5, -78.9, -63.0, -49.3, -37.6, -27.6, -19.0, -11.6, -5.3, 0.1]
    };
    const breakevenLineChart = new ApexCharts(document.querySelector("#breakevenLineChart"), {
        ...chartOptions,
        series: [{ name: 'ุฌุฑุงู ููุฏ ุชุฌูุน (ุจุฑุง PP)', data: breakevenData.cumulative_fcf }, { name: 'ุฎุงูุต ุงุฑุฒุด ูุนู ุชุฌูุน (ุจุฑุง DPBP)', data: breakevenData.cumulative_npv }],
        chart: { ...chartOptions.chart, height: 350, type: 'line' },
        xaxis: { title: { text: 'ุณุงู ูพุฑูฺู', style: { fontFamily: 'Vazirmatn', fontWeight: 400 }}, categories: breakevenData.years },
        yaxis: { title: { text: 'ููุงุฑุฏ ุฑุงู', style: { fontFamily: 'Vazirmatn', fontWeight: 400 }}},
        colors: ['#f97316', '#0891b2'],
        legend: { position: 'top', horizontalAlign: 'left' },
        annotations: {
            xaxis: [{ x: breakevenData.years[4], x2: breakevenData.years[5], offsetX:-25, borderColor: '#f97316', label: { borderColor: '#f97316', style: { color: '#fff', background: '#f97316', fontFamily: 'Vazirmatn' }, text: 'PP: 3.63 ุณุงู' }},
                    { x: breakevenData.years[19], offsetX:20, borderColor: '#0891b2', label: { borderColor: '#0891b2', style: { color: '#fff', background: '#0891b2', fontFamily: 'Vazirmatn' }, text: 'DPBP: 18.98 ุณุงู' }}],
            yaxis: [{ y: 0, borderColor: '#1e293b', label: { borderColor: '#1e293b', style: { color: '#fff', background: '#1e293b', fontFamily: 'Vazirmatn' }, text: 'ููุทู ุณุฑ ุจู ุณุฑ' }}]
        }
    });
    breakevenLineChart.render();
    
    // CAPEX Chart
    const capexData = {
        series: [285.0, 80.0, 55.0, 45.0, 30.0, 10.0, 23.5, 46.5],
        labels: ['ูุฒูู ุงุจูู ู ุณุงุฎุชโูุณุงุฒ', 'ูุญูุทูโุณุงุฒ ู ุขูุงุฏูโุณุงุฒ ุฒูู', 'ุชุฃุณุณุงุช', 'ุชุฌูุฒุงุช ุจุงุบ ุฎุฒูุฏฺฏุงู', 'ุชุฌูุฒุงุช ูพุฐุฑุง', 'ุชุฌูุฒุงุช ฺฉููฺฉ', 'ูุฒููโูุง ูุจู ุงุฒ ุจูุฑูโุจุฑุฏุงุฑ', 'ูุฒููโูุง ูพุดโุจู ูุดุฏู']
    };
    const totalCapex = capexData.series.reduce((a, b) => a + b, 0);

    const capexChartOptions = {
        series: capexData.series,
        chart: { 
            type: 'donut', 
            height: 300 
        },
        labels: capexData.labels,
        legend: { 
            show: false
        },
        tooltip: { 
            y: { formatter: (val) => val + " ููุงุฑุฏ ุฑุงู" }, 
            style: { fontFamily: 'Vazirmatn, sans-serif' }
        },
        plotOptions: {
            pie: {
                donut: {
                    labels: {
                        show: true,
                        total: {
                            show: true,
                            label: 'ุฌูุน ฺฉู',
                            fontSize: '18px',
                            fontWeight: 'bold',
                            formatter: () => `${totalCapex.toFixed(1)}`
                        }
                    }
                }
            }
        },
        dataLabels: {
            enabled: false
        }
    };

    const capexChart = new ApexCharts(document.querySelector("#capexChart"), capexChartOptions);
    capexChart.render();

    // Interactivity for CAPEX Table
    const capexTableRows = document.querySelectorAll('#capex-table tbody tr, #capex-table tfoot tr');
    capexTableRows.forEach(row => {
        row.addEventListener('click', () => {
            const index = row.getAttribute('data-index');
            capexTableRows.forEach(r => r.classList.remove('bg-sky-100', 'dark:bg-sky-900/50'));
            row.classList.add('bg-sky-100', 'dark:bg-sky-900/50');
            
            let newTotalOptions;

            if (index === 'total' || index === null) {
                newTotalOptions = {
                    label: 'ุฌูุน ฺฉู',
                    formatter: () => `${totalCapex.toFixed(1)}`
                };
            } else {
                const seriesIndex = parseInt(index);
                const value = capexData.series[seriesIndex];
                const percentage = (value / totalCapex * 100).toFixed(1);
                newTotalOptions = {
                    label: capexData.labels[seriesIndex],
                    formatter: () => `${percentage}%`
                };
            }

            capexChart.updateOptions({
                plotOptions: {
                    pie: {
                        donut: {
                            labels: {
                                total: newTotalOptions
                            }
                        }
                    }
                }
            });
        });

        row.addEventListener('mouseover', () => {
            const index = row.getAttribute('data-index');
            if (index !== 'total' && index !== null) {
                capexChart.toggleDataPointSelection(parseInt(index));
            }
        });
        row.addEventListener('mouseout', () => {
            const index = row.getAttribute('data-index');
            if (index !== 'total' && index !== null) {
                capexChart.toggleDataPointSelection(parseInt(index));
            }
        });
    });


    // New Roadmap Chart (Chart.js)
    const newRoadmapChart = new Chart(document.getElementById('newRoadmapChart').getContext('2d'), {
        type: 'bar', 
        data: { 
            labels: ['ุฏูุฑุงู ุจูุฑู\u200cุจุฑุฏุงุฑ', 'ุจุงุฒฺฏุดุช ุณูุฏ ู ุณุฑูุงู', 'ุจุงุฒฺฏุดุช ุณุฑูุงู'], 
            datasets: [{ 
                data: [[0, 19], [0, 18.98], [0, 3.63]], 
                backgroundColor: ['#2dd4bf', '#f97316', '#fbbf24'], 
                borderWidth: 1, 
                borderColor: '#fff', 
                barPercentage: 0.6 
            }] 
        },
        options: { 
            ...chartDefaultOptions, 
            indexAxis: 'y', 
            plugins: {
                legend: {display: false}, 
                tooltip: {
                    callbacks: { 
                        label: (ctx) => ` ${ctx.raw[1].toFixed(2)} ุณุงู`
                    }
                }
            }, 
            scales: { 
                x: { 
                    min: 0, 
                    max: 20, 
                    ticks: { color: '#64748b', stepSize: 2, font:{family: 'Vazirmatn'} }, 
                    grid: { color: '#e2e8f0' }, 
                    title: { display: true, text: 'ุณุงู\u200cูุง ุจูุฑู\u200cุจุฑุฏุงุฑ', color: '#334155', font: { family: 'Vazirmatn' } } 
                }, 
                y: { 
                    ticks: {color: '#334155', font:{family: 'Vazirmatn'}}, 
                    grid: { display: false } 
                } 
            } 
        }
    });

    // Sensitivity Heatmap (Chart.js)
    const ctxHeatmap = document.getElementById('sensitivityHeatmap').getContext('2d');
    const heatmapData = {
        labels: ['-20%', '-10%', '0%', '+10%', '+20%'], // Cost Changes
        datasets: [
            { label: '+20%', data: [45.3, 44.1, 42.9, 41.7, 40.5] },
            { label: '+10%', data: [44.0, 42.9, 41.7, 40.6, 39.4] },
            { label: '0%',   data: [42.6, 41.3, 40.0, 38.8, 37.5] },
            { label: '-10%', data: [41.1, 39.8, 38.5, 37.1, 35.8] },
            { label: '-20%', data: [39.5, 38.2, 36.8, 35.5, 34.2] }
        ]
    };
    const matrixData = heatmapData.datasets.flatMap((dataset) => 
        dataset.data.map((value, j) => ({ x: heatmapData.labels[j], y: dataset.label, v: value }))
    );

    const datalabelsPlugin = {
        id: 'datalabels',
        afterDatasetsDraw(chart) {
            const { ctx } = chart;
            const isDark = document.documentElement.classList.contains('dark');
            ctx.save();
            chart.getDatasetMeta(0).data.forEach((datapoint, index) => {
                const { x, y, width, height } = datapoint.getProps(['x', 'y', 'width', 'height']);
                const value = chart.data.datasets[0].data[index].v;
                ctx.font = 'bold 14px Vazirmatn';
                if(isDark) {
                    ctx.fillStyle = 'white';
                } else {
                    ctx.fillStyle = value >= 41 ? 'white' : 'black';
                }
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(`${value}%`, x + width / 2, y + height / 2);
            });
            ctx.restore();
        }
    };

    const sensitivityHeatmap = new Chart(ctxHeatmap, {
        type: 'matrix',
        data: {
            datasets: [{
                label: 'IRR',
                data: matrixData,
                backgroundColor: (ctx) => {
                    const value = ctx.dataset.data[ctx.dataIndex].v;
                    if (value >= 42) return 'rgba(16, 185, 129, 0.9)'; // Dark Green
                    if (value >= 40) return 'rgba(59, 130, 246, 0.85)'; // Blue
                    if (value >= 37) return 'rgba(245, 158, 11, 0.85)'; // Amber
                    return 'rgba(239, 68, 68, 0.85)'; // Red
                },
                borderColor: 'white',
                borderWidth: 2,
                width: ({ chart }) => (chart.chartArea || {}).width / heatmapData.labels.length,
                height: ({ chart }) => (chart.chartArea || {}).height / heatmapData.datasets.length,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: {
                    type: 'category',
                    labels: heatmapData.labels,
                    title: { display: true, text: 'ุชุบุฑ ุฏุฑ ูุฒูู ูุง', font: { size: 14, weight: 'bold', family: 'Vazirmatn' } },
                    grid: { display: false },
                },
                y: {
                    type: 'category',
                    labels: heatmapData.datasets.map(d => d.label).reverse(),
                    title: { display: true, text: 'ุชุบุฑ ุฏุฑ ุฏุฑุขูุฏูุง', font: { size: 14, weight: 'bold', family: 'Vazirmatn' } },
                    grid: { display: false },
                    offset: true,
                }
            },
            plugins: {
                legend: { display: false },
                tooltip: {
                    bodyFont: { family: 'Vazirmatn' },
                    titleFont: { family: 'Vazirmatn' },
                    callbacks: {
                        title: () => '',
                        label: (context) => {
                            const item = context.dataset.data[context.dataIndex];
                            return [`ูุฑุฎ ุจุงุฒุฏู ุฏุงุฎู: ${item.v}%`, `ุชุบุฑ ุฏุฑุขูุฏ: ${item.y}`, `ุชุบุฑ ูุฒูู: ${item.x}`];
                        }
                    }
                }
            }
        },
        plugins: [datalabelsPlugin]
    });

    // --- THEME TOGGLER SCRIPT ---
    document.addEventListener('DOMContentLoaded', () => {
        lucide.createIcons();

        // Define constants and functions that depend on the DOM after it's ready
        const themeToggleBtn = document.getElementById('theme-toggle');
        const themeIconSun = document.getElementById('theme-icon-sun');
        const themeIconMoon = document.getElementById('theme-icon-moon');
        const docElement = document.documentElement;

        const allCharts = {
            apex: [cashFlowChart, revenueOpexChart, breakevenLineChart, capexChart],
            chartjs: [newRoadmapChart, sensitivityHeatmap]
        };

        function getApexThemeOptions(isDark) {
            const textColor = isDark ? '#e2e8f0' : '#334155';
            return {
                theme: { mode: isDark ? 'dark' : 'light' },
                chart: { 
                    foreColor: textColor,
                    background: 'transparent'
                },
                xaxis: { title: { style: { color: textColor } } },
                yaxis: [{ title: { style: { color: textColor } } }],
            };
        }

        function getChartJsThemeOptions(isDark) {
            const textColor = isDark ? '#e2e8f0' : '#334155';
            const gridColor = isDark ? '#334155' : '#e2e8f0';
            return {
                scales: {
                    x: {
                        ticks: { color: textColor },
                        grid: { color: gridColor },
                        title: { color: textColor, font: { family: 'Vazirmatn' } }
                    },
                    y: {
                        ticks: { color: textColor },
                        grid: { color: gridColor },
                        title: { color: textColor, font: { family: 'Vazirmatn' } }
                    }
                },
            };
        }

        function updateChartsTheme(isDark) {
            // Update ApexCharts
            const apexOptions = getApexThemeOptions(isDark);
            allCharts.apex.forEach(chart => chart.updateOptions(apexOptions));

            // Update Chart.js charts
            const chartJsOptions = getChartJsThemeOptions(isDark);
            allCharts.chartjs.forEach(chart => {
                Object.assign(chart.options.scales.x, chartJsOptions.scales.x);
                Object.assign(chart.options.scales.y, chartJsOptions.scales.y);
                chart.update();
            });
        }

        function setTheme(isDark) {
            if (isDark) {
                docElement.classList.add('dark');
                themeIconSun.classList.remove('hidden');
                themeIconMoon.classList.add('hidden');
                localStorage.setItem('theme', 'dark');
            } else {
                docElement.classList.remove('dark');
                themeIconSun.classList.add('hidden');
                themeIconMoon.classList.remove('hidden');
                localStorage.setItem('theme', 'light');
            }
            updateChartsTheme(isDark);
        }

        themeToggleBtn.addEventListener('click', () => {
            const isCurrentlyDark = docElement.classList.contains('dark');
            setTheme(!isCurrentlyDark);
        });

        // Set initial theme
        const savedTheme = localStorage.getItem('theme');
        const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (savedTheme === 'dark' || (!savedTheme && systemPrefersDark)) {
            setTheme(true);
        } else {
            setTheme(false);
        }
    });

</script>
</body>
</html>

